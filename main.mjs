// silux 0.5.0 | MIT | https://github.com/urbandrone/silux
function t(t){if(e(t)){for(;t&&e(t);){t=n(t).parent}return null!=t?t:null}return t.parentNode}function e(t){return 11===t.nodeType}function n(t,e){var n,r,o,i=t;return null!==(n=i.parent)&&void 0!==n||(i.parent=null!=e?e:null),null!==(r=i.firstChildNode)&&void 0!==r||(i.firstChildNode=t.firstChild),null!==(o=i.lastChildNode)&&void 0!==o||(i.lastChildNode=t.lastChild),i}var r={createElement:function(t,e){return document.createElement(t,e)},createElementNS:function(t,e,n){return document.createElementNS(t,e,n)},createTextNode:function(t){return document.createTextNode(t)},createDocumentFragment:function(){return n(document.createDocumentFragment())},createComment:function(t){return document.createComment(t)},insertBefore:function(t,r,o){if(e(t)){for(var i=t;i&&e(i);){i=n(i).parent}t=null!=i?i:t}e(r)&&(r=n(r,t)),o&&e(o)&&(o=n(o).firstChildNode),t.insertBefore(r,o)},removeChild:function(t,e){t.removeChild(e)},appendChild:function(t,r){e(r)&&(r=n(r,t)),t.appendChild(r)},parentNode:t,nextSibling:function(r){var o;if(e(r)){var i=n(r),l=t(i);if(l&&i.lastChildNode){var u=Array.from(l.childNodes),a=u.indexOf(i.lastChildNode);return null!==(o=u[a+1])&&void 0!==o?o:null}return null}return r.nextSibling},tagName:function(t){return t.tagName},setTextContent:function(t,e){t.textContent=e},getTextContent:function(t){return t.textContent},isElement:function(t){return 1===t.nodeType},isText:function(t){return 3===t.nodeType},isComment:function(t){return 8===t.nodeType},isDocumentFragment:e};function o(t,e,n,r,o){return{sel:t,data:e,children:n,text:r,elm:o,key:void 0===e?void 0:e.key}}var i=Array.isArray;function l(t){return"string"==typeof t||"number"==typeof t||t instanceof String||t instanceof Number}function u(t){return void 0===t}function a(t){return void 0!==t}var c=o("",{},[],void 0,void 0);function f(t,e){var n,r,o=t.key===e.key,i=(null===(n=t.data)||void 0===n?void 0:n.is)===(null===(r=e.data)||void 0===r?void 0:r.is),l=t.sel===e.sel,u=!(!t.sel&&t.sel===e.sel)||typeof t.text==typeof e.text;return l&&o&&i&&u}function s(){throw new Error("The document fragment is not supported on this platform.")}function d(t,e,n){for(var r,o={},i=e;i<=n;++i){var l=null===(r=t[i])||void 0===r?void 0:r.key;void 0!==l&&(o[l]=i)}return o}var v=["create","update","remove","destroy","pre","post"];function h(t,e,n){if(t.ns="http://www.w3.org/2000/svg","foreignObject"!==n&&void 0!==e)for(var r=0;r<e.length;++r){var o=e[r];if("string"!=typeof o){var i=o.data;void 0!==i&&h(i,o.children,o.sel)}}}function p(t,e,n){var r,u,a,c={};if(void 0!==n?(null!==e&&(c=e),i(n)?r=n:l(n)?u=n.toString():n&&n.sel&&(r=[n])):null!=e&&(i(e)?r=e:l(e)?u=e.toString():e&&e.sel?r=[e]:c=e),void 0!==r)for(a=0;a<r.length;++a)l(r[a])&&(r[a]=o(void 0,void 0,void 0,r[a],void 0));return"s"!==t[0]||"v"!==t[1]||"g"!==t[2]||3!==t.length&&"."!==t[3]&&"#"!==t[3]||h(c,r,t),o(t,c,r,u,void 0)}var m=/[A-Z]/g;function g(t,e){var n,r=e.elm,o=t.data.dataset,i=e.data.dataset;if((o||i)&&o!==i){o=o||{},i=i||{};var l=r.dataset;for(n in o)i[n]||(l?n in l&&delete l[n]:r.removeAttribute("data-"+n.replace(m,"-$&").toLowerCase()));for(n in i)o[n]!==i[n]&&(l?l[n]=i[n]:r.setAttribute("data-"+n.replace(m,"-$&").toLowerCase(),i[n]))}}var y={create:g,update:g};function w(t,e,n){if("function"==typeof t)t.call(e,n,e);else if("object"==typeof t)for(var r=0;r<t.length;r++)w(t[r],e,n)}function x(t,e){var n=t.type,r=e.data.on;r&&r[n]&&w(r[n],e,t)}function b(t,e){var n,r=t.data.on,o=t.listener,i=t.elm,l=e&&e.data.on,u=e&&e.elm;if(r!==l){if(r&&o)if(l)for(n in r)l[n]||i.removeEventListener(n,o,!1);else for(n in r)i.removeEventListener(n,o,!1);if(l){var a=e.listener=t.listener||function t(e){x(e,t.vnode)};if(a.vnode=e,r)for(n in l)r[n]||u.addEventListener(n,a,!1);else for(n in l)u.addEventListener(n,a,!1)}}}var C={create:b,update:b,destroy:b};function E(t,e){var n,r,o=e.elm,i=t.data.props,l=e.data.props;if((i||l)&&i!==l)for(n in i=i||{},l=l||{})r=l[n],i[n]===r||"value"===n&&o[n]===r||(o[n]=r)}var _={create:E,update:E},N="undefined"!=typeof window&&window.requestAnimationFrame.bind(window)||setTimeout,T=!1;function S(t,e,n){var r;r=function(){t[e]=n},N((function(){N(r)}))}function O(t,e){var n,r,o=e.elm,i=t.data.style,l=e.data.style;if((i||l)&&i!==l){l=l||{};var u="delayed"in(i=i||{});for(r in i)l[r]||("-"===r[0]&&"-"===r[1]?o.style.removeProperty(r):o.style[r]="");for(r in l)if(n=l[r],"delayed"===r&&l.delayed)for(var a in l.delayed)n=l.delayed[a],u&&n===i.delayed[a]||S(o.style,a,n);else"remove"!==r&&n!==i[r]&&("-"===r[0]&&"-"===r[1]?o.style.setProperty(r,n):o.style[r]=n)}}var A={pre:function(){T=!1},create:O,update:O,destroy:function(t){var e,n,r=t.elm,o=t.data.style;if(o&&(e=o.destroy))for(n in e)r.style[n]=e[n]},remove:function(t,e){var n=t.data.style;if(n&&n.remove){var r;T||(t.elm.offsetLeft,T=!0);var o=t.elm,i=0,l=n.remove,u=0,a=[];for(r in l)a.push(r),o.style[r]=l[r];for(var c=getComputedStyle(o)["transition-property"].split(", ");i<c.length;++i)-1!==a.indexOf(c[i])&&u++;o.addEventListener("transitionend",(function(t){t.target===o&&--u,0===u&&e()}))}else e()}},j=function(t,e,n){var h={create:[],update:[],remove:[],destroy:[],pre:[],post:[]},p=void 0!==e?e:r;for(var m of v)for(var g of t){var y=g[m];void 0!==y&&h[m].push(y)}function w(t){var e=t.id?"#"+t.id:"",n=t.getAttribute("class"),r=n?"."+n.split(" ").join("."):"";return o(p.tagName(t).toLowerCase()+e+r,{},[],void 0,t)}function x(t){return o(void 0,{},[],void 0,t)}function b(t,e){return function(){if(0==--e){var n=p.parentNode(t);p.removeChild(n,t)}}}function C(t,e){var r,o,f,d,v,m=t.data;if(void 0!==m){var g=null===(r=m.hook)||void 0===r?void 0:r.init;a(g)&&(g(t),m=t.data)}var y=t.children,w=t.sel;if("!"===w)u(t.text)&&(t.text=""),t.elm=p.createComment(t.text);else if(void 0!==w){var x=w.indexOf("#"),b=w.indexOf(".",x),E=x>0?x:w.length,_=b>0?b:w.length,N=-1!==x||-1!==b?w.slice(0,Math.min(E,_)):w,T=t.elm=a(m)&&a(v=m.ns)?p.createElementNS(v,N,m):p.createElement(N,m);for(E<_&&T.setAttribute("id",w.slice(E+1,_)),b>0&&T.setAttribute("class",w.slice(_+1).replace(/\./g," ")),v=0;v<h.create.length;++v)h.create[v](c,t);if(i(y))for(v=0;v<y.length;++v){var S=y[v];null!=S&&p.appendChild(T,C(S,e))}else l(t.text)&&p.appendChild(T,p.createTextNode(t.text));var O=t.data.hook;a(O)&&(null===(o=O.create)||void 0===o||o.call(O,c,t),O.insert&&e.push(t))}else if((null===(f=null==n?void 0:n.experimental)||void 0===f?void 0:f.fragments)&&t.children){for(t.elm=(null!==(d=p.createDocumentFragment)&&void 0!==d?d:s)(),v=0;v<h.create.length;++v)h.create[v](c,t);for(v=0;v<t.children.length;++v){var A=t.children[v];null!=A&&p.appendChild(t.elm,C(A,e))}}else t.elm=p.createTextNode(t.text);return t.elm}function E(t,e,n,r,o,i){for(;r<=o;++r){var l=n[r];null!=l&&p.insertBefore(t,C(l,i),e)}}function _(t){var e,n,r=t.data;if(void 0!==r){null===(n=null===(e=null==r?void 0:r.hook)||void 0===e?void 0:e.destroy)||void 0===n||n.call(e,t);for(var o=0;o<h.destroy.length;++o)h.destroy[o](t);if(void 0!==t.children)for(var i=0;i<t.children.length;++i){var l=t.children[i];null!=l&&"string"!=typeof l&&_(l)}}}function N(t,e,n,r){for(var o,i;n<=r;++n){var l=void 0,u=void 0,c=e[n];if(null!=c)if(a(c.sel)){_(c),l=h.remove.length+1,u=b(c.elm,l);for(var f=0;f<h.remove.length;++f)h.remove[f](c,u);var s=null===(i=null===(o=null==c?void 0:c.data)||void 0===o?void 0:o.hook)||void 0===i?void 0:i.remove;a(s)?s(c,u):u()}else c.children?(_(c),N(t,c.children,0,c.children.length-1)):p.removeChild(t,c.elm)}}function T(t,e,n){var r,o,i,l,c,s,v,m,g=null===(r=e.data)||void 0===r?void 0:r.hook;null===(o=null==g?void 0:g.prepatch)||void 0===o||o.call(g,t,e);var y=e.elm=t.elm;if(t!==e){if(void 0!==e.data||a(e.text)&&e.text!==t.text){null!==(i=e.data)&&void 0!==i||(e.data={}),null!==(l=t.data)&&void 0!==l||(t.data={});for(var w=0;w<h.update.length;++w)h.update[w](t,e);null===(v=null===(s=null===(c=e.data)||void 0===c?void 0:c.hook)||void 0===s?void 0:s.update)||void 0===v||v.call(s,t,e)}var x=t.children,b=e.children;u(e.text)?a(x)&&a(b)?x!==b&&function(t,e,n,r){for(var o,i,l,a=0,c=0,s=e.length-1,v=e[0],h=e[s],m=n.length-1,g=n[0],y=n[m];a<=s&&c<=m;)null==v?v=e[++a]:null==h?h=e[--s]:null==g?g=n[++c]:null==y?y=n[--m]:f(v,g)?(T(v,g,r),v=e[++a],g=n[++c]):f(h,y)?(T(h,y,r),h=e[--s],y=n[--m]):f(v,y)?(T(v,y,r),p.insertBefore(t,v.elm,p.nextSibling(h.elm)),v=e[++a],y=n[--m]):f(h,g)?(T(h,g,r),p.insertBefore(t,h.elm,v.elm),h=e[--s],g=n[++c]):(void 0===o&&(o=d(e,a,s)),u(i=o[g.key])||(l=e[i]).sel!==g.sel?p.insertBefore(t,C(g,r),v.elm):(T(l,g,r),e[i]=void 0,p.insertBefore(t,l.elm,v.elm)),g=n[++c]);c<=m&&E(t,null==n[m+1]?null:n[m+1].elm,n,c,m,r),a<=s&&N(t,e,a,s)}(y,x,b,n):a(b)?(a(t.text)&&p.setTextContent(y,""),E(y,null,b,0,b.length-1,n)):a(x)?N(y,x,0,x.length-1):a(t.text)&&p.setTextContent(y,""):t.text!==e.text&&(a(x)&&N(y,x,0,x.length-1),p.setTextContent(y,e.text)),null===(m=null==g?void 0:g.postpatch)||void 0===m||m.call(g,t,e)}}return function(t,e){var n,r,o,i=[];for(n=0;n<h.pre.length;++n)h.pre[n]();for(!function(t,e){return t.isElement(e)}(p,t)?function(t,e){return t.isDocumentFragment(e)}(p,t)&&(t=x(t)):t=w(t),f(t,e)?T(t,e,i):(r=t.elm,o=p.parentNode(r),C(e,i),null!==o&&(p.insertBefore(o,e.elm,p.nextSibling(r)),N(o,[t],0,0))),n=0;n<i.length;++n)i[n].data.hook.insert(i[n]);for(n=0;n<h.post.length;++n)h.post[n]();return e}}([_,A,C,y]),L=function(t){return e=t,function(t,n,r){return o=t(n,r),e=j(e,o);var o};var e},k=function(){function t(e,n){var r=Object.create(t.prototype),o=arguments.length;return function(){if(2!==o)return function(){throw new Error("_effectful received invalid number of arguments.")}.call(this)}.call(this),r.state=e,r.effects=n,r}return t.is=function(e){return e instanceof t},t}.call(void 0);k.prototype.run=function(t,e,n){return function(r){return function(){if(r.state!==t)return e.forEach((function(t){return t({state:r.state})})),function(){if(Array.isArray(r.effects)&&r.effects.length>0)return requestAnimationFrame((function(){return r.effects.forEach((function(t){return t(n,r.state)}))}))}.call(this)}.call(this),r}(this)},k.prototype.extract=function(){return this.state};var B=function(t){return new URLSearchParams(t).entries().reduce((function(t,e){var n=e[0],r=e[1];return t[n]=r,t}),Object.create(null))},F=function(){return{url:window.location.href,origin:window.location.origin,host:window.location.hostname,port:window.location.port,protocol:location.protocol,path:window.location.pathname,hash:window.location.hash,search:B(window.location.search)}},R=function(t,e,n){return e[n]===t},D=function(t){return R(":",t,0)},$=function(t){return t.split(new RegExp("\\/","g"))},P=function(t){return t.replace(new RegExp("\\/+","g"),"/").replace(new RegExp("^\\/|\\/$","g"),"")},q=function(t,e){return n=P(t),r=P(e),n===r?1/0:(o=n,new RegExp("^404$","g").test(o)?.5:function(t,e){return function(){return t.length!==e.length?0:e.reduce((function(e,n,r){return function(){return D(n)?1+e:R(n,t,r)?2+e:e}.call(this)}),0)}.call(this)}($(r),$(n)));var n,r,o},U=function(t,e){return n=$(P(t)),r=$(P(e)),n.reduce((function(t,e,n){return function(){return D(e)?(o=e.slice(1),t[o]=r[n],t):t;var o}.call(this)}),Object.create(null));var n,r},M=function(){var t=Object.create(null);return t.prototype={__sibilispType__:t},t.moveTo=function e(n,r){var o=Object.create(t.prototype),i=arguments.length;return function(){if(2!==i)return function(){throw new Error("Tagged constructor "+M+"."+e+"expects 2 arguments but got "+i)}.call(this)}.call(this),o.url=n,o.action=r,o.constructor=e,o.__sibilispCtor__="move-to",o.__sibilispTags__=["url","action"],o},t.resolve=function e(n,r){var o=Object.create(t.prototype),i=arguments.length;return function(){if(2!==i)return function(){throw new Error("Tagged constructor "+M+"."+e+"expects 2 arguments but got "+i)}.call(this)}.call(this),o.url=n,o.action=r,o.constructor=e,o.__sibilispCtor__="resolve",o.__sibilispTags__=["url","action"],o},t.prototype.match=function(t){var e=this,n=e.__sibilispCtor__,r=t[n],o=e.__sibilispTags__;return function(){return"function"==typeof r?r.apply(e,o.map((function(t){return e[t]}))):"function"==typeof t.else?t.else.apply(e,o.map((function(t){return e[t]}))):function(){throw new Error(".match :: Cannot find "+n+" in patterns "+t)}.call(this)}.call(this)},t.is=function(e){return!(null==e)&&e.__sibilispType__===t},t}.call(void 0),Z=function(t,e){return M.resolve(t,e)},z=function(t,e){var n,r;e=Array.prototype.slice.call(arguments,1);return n=t.dispatch,r=t.notify,e.forEach((function(e){return r=e.el,o=e.view,i=L(r),t.subscribe((function(t){return r=i(o,t,n)}));var r,o,i})),function(t){return function(){return null!=t?n(t):r()}.call(this),null}},G=function(t,e,n){return n=void 0!==n?n:[],function(t,e,r,o,i,l){return i.getState=function(){return function(){if(!r)return function(){throw new Error("(silux/store.get-state) is disallowed during a dispatch")}.call(this)}.call(this),{state:t}},i.dispatch=function(n){return function(){if(!r)return function(){throw new Error("(silux/store.dispatch) is disallowed during a dispatch")}.call(this)}.call(this),u=i.dispatch,r=!1,e=t,t=l(t,n,u).run(e,o,u).extract(),r=!0,i;var u},i.subscribe=function(t){return function(){if(!r)return function(){throw new Error("(silux/store.subscribe) is disallowed during a dispatch")}.call(this)}.call(this),function(){if(!o.has(t))return o.add(t)}.call(this),i},i.notify=function(){return function(){if(!r)return function(){throw new Error("(silux/store.notify) is disallowed during a dispatch")}.call(this)}.call(this),o.forEach((function(e){return e({state:t})})),i},n.reduce((function(t,e){return e(t)}),i)}(t,null,!0,new Set([]),Object.create(null),(r=e,function(t,e,n){return function(t){return function(){if(!k.is(t))return t=k(t,[])}.call(this),t}(r(t,e,n))}));var r},H=function(t){t=Array.prototype.slice.call(arguments,0);return function(e,n,r){return t.reduce((function(t,e){return e(t,n,r)}),e)}},I=function(t,e){e=Array.prototype.slice.call(arguments,1);return k(t,e)},J=function(t,e,n){return p(t,null!=e&&e.constructor===Object?e:Object.create(null),n.map((function(t){return"number"!=typeof t||Number.isNaN(t)?t:String(t)})))},K=function(t){return n=getBaseUi(),r=Object.entries(t),e=function(t){return r.reduce((function(e,r){var o=r[0],i=r[1];return function(r){return function(){return r>0?e.concat({r:r,s:o,p:U(n+o,t),v:i}):e}.call(this)}(q(n+o,t))}),[]).sort((function(t,e){return t.r>e.r?-1:e.r>t.r?1:0}))[0]},function(t,n){var r=t.state;return function(t){return function(){return null!=t?t.v({state:r,route:Object.assign({},F(),{params:t.p,slug:t.s})},n):function(t){return"silux/route-error: found no matching route definition for "+t}(window.location.pathname)}.call(this)}(e(window.location.pathname))};var e,n,r},Q=function(){return function(t){return function(e,n,r,o){return o.getState=function(){return{state:r().state,route:F()}},o.dispatch=function(t){return function(){return actionRouter.is(t)?t.match({resolve:function(t,r){return function(){return null!=r?e(r):n()}.call(this)},moveTo:function(t,r){return function(t,e){e=void 0!==e?e:{},window.history.pushState(e,"",t)}(t),function(){return null!=r?e(r):n()}.call(this)}}):e(t)}.call(this),o},o.subscribe=t.subscribe,o.notify=n,function(){var t={passive:!0},e=function(){return o.dispatch(Z(location.pathname))},n=function(){return window.removeEventListener("popstate",e,t),window.removeEventListener("beforeunload",n,t)};return window.addEventListener("popstate",e,t),window.addEventListener("beforeunload",n,t),o}.call(this)}(t.dispatch,t.notify,t.getState,Object.create(null))}},V=function(t,e){return M.moveTo(t,e)},W=Z;export{V as goRoute,J as h,W as resolveRoute,z as siluxConnect,H as siluxFoldUpdates,K as siluxRouter,Q as siluxRouterPlugin,G as siluxStore,I as withEffects};
