// silux 0.6.0 | MIT | https://github.com/urbandrone/silux
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).silux={})}(this,(function(t){"use strict";function e(t){if(n(t)){for(;t&&n(t);){t=r(t).parent}return null!=t?t:null}return t.parentNode}function n(t){return 11===t.nodeType}function r(t,e){var n,r,o,i=t;return null!==(n=i.parent)&&void 0!==n||(i.parent=null!=e?e:null),null!==(r=i.firstChildNode)&&void 0!==r||(i.firstChildNode=t.firstChild),null!==(o=i.lastChildNode)&&void 0!==o||(i.lastChildNode=t.lastChild),i}var o={createElement:function(t,e){return document.createElement(t,e)},createElementNS:function(t,e,n){return document.createElementNS(t,e,n)},createTextNode:function(t){return document.createTextNode(t)},createDocumentFragment:function(){return r(document.createDocumentFragment())},createComment:function(t){return document.createComment(t)},insertBefore:function(t,e,o){if(n(t)){for(var i=t;i&&n(i);){i=r(i).parent}t=null!=i?i:t}n(e)&&(e=r(e,t)),o&&n(o)&&(o=r(o).firstChildNode),t.insertBefore(e,o)},removeChild:function(t,e){t.removeChild(e)},appendChild:function(t,e){n(e)&&(e=r(e,t)),t.appendChild(e)},parentNode:e,nextSibling:function(t){var o;if(n(t)){var i=r(t),l=e(i);if(l&&i.lastChildNode){var u=Array.from(l.childNodes),a=u.indexOf(i.lastChildNode);return null!==(o=u[a+1])&&void 0!==o?o:null}return null}return t.nextSibling},tagName:function(t){return t.tagName},setTextContent:function(t,e){t.textContent=e},getTextContent:function(t){return t.textContent},isElement:function(t){return 1===t.nodeType},isText:function(t){return 3===t.nodeType},isComment:function(t){return 8===t.nodeType},isDocumentFragment:n};function i(t,e,n,r,o){return{sel:t,data:e,children:n,text:r,elm:o,key:void 0===e?void 0:e.key}}var l=Array.isArray;function u(t){return"string"==typeof t||"number"==typeof t||t instanceof String||t instanceof Number}function a(t){return void 0===t}function c(t){return void 0!==t}var f=i("",{},[],void 0,void 0);function s(t,e){var n,r,o=t.key===e.key,i=(null===(n=t.data)||void 0===n?void 0:n.is)===(null===(r=e.data)||void 0===r?void 0:r.is),l=t.sel===e.sel,u=!(!t.sel&&t.sel===e.sel)||typeof t.text==typeof e.text;return l&&o&&i&&u}function d(){throw new Error("The document fragment is not supported on this platform.")}function v(t,e,n){for(var r,o={},i=e;i<=n;++i){var l=null===(r=t[i])||void 0===r?void 0:r.key;void 0!==l&&(o[l]=i)}return o}var h=["create","update","remove","destroy","pre","post"];function p(t,e,n){if(t.ns="http://www.w3.org/2000/svg","foreignObject"!==n&&void 0!==e)for(var r=0;r<e.length;++r){var o=e[r];if("string"!=typeof o){var i=o.data;void 0!==i&&p(i,o.children,o.sel)}}}function m(t,e,n){var r,o,a,c={};if(void 0!==n?(null!==e&&(c=e),l(n)?r=n:u(n)?o=n.toString():n&&n.sel&&(r=[n])):null!=e&&(l(e)?r=e:u(e)?o=e.toString():e&&e.sel?r=[e]:c=e),void 0!==r)for(a=0;a<r.length;++a)u(r[a])&&(r[a]=i(void 0,void 0,void 0,r[a],void 0));return"s"!==t[0]||"v"!==t[1]||"g"!==t[2]||3!==t.length&&"."!==t[3]&&"#"!==t[3]||p(c,r,t),i(t,c,r,o,void 0)}var g=/[A-Z]/g;function y(t,e){var n,r=e.elm,o=t.data.dataset,i=e.data.dataset;if((o||i)&&o!==i){o=o||{},i=i||{};var l=r.dataset;for(n in o)i[n]||(l?n in l&&delete l[n]:r.removeAttribute("data-"+n.replace(g,"-$&").toLowerCase()));for(n in i)o[n]!==i[n]&&(l?l[n]=i[n]:r.setAttribute("data-"+n.replace(g,"-$&").toLowerCase(),i[n]))}}var w={create:y,update:y};function x(t,e,n){if("function"==typeof t)t.call(e,n,e);else if("object"==typeof t)for(var r=0;r<t.length;r++)x(t[r],e,n)}function b(t,e){var n=t.type,r=e.data.on;r&&r[n]&&x(r[n],e,t)}function C(t,e){var n,r=t.data.on,o=t.listener,i=t.elm,l=e&&e.data.on,u=e&&e.elm;if(r!==l){if(r&&o)if(l)for(n in r)l[n]||i.removeEventListener(n,o,!1);else for(n in r)i.removeEventListener(n,o,!1);if(l){var a=e.listener=t.listener||function t(e){b(e,t.vnode)};if(a.vnode=e,r)for(n in l)r[n]||u.addEventListener(n,a,!1);else for(n in l)u.addEventListener(n,a,!1)}}}var E={create:C,update:C,destroy:C};function _(t,e){var n,r,o=e.elm,i=t.data.props,l=e.data.props;if((i||l)&&i!==l)for(n in i=i||{},l=l||{})r=l[n],i[n]===r||"value"===n&&o[n]===r||(o[n]=r)}var T={create:_,update:_},N="undefined"!=typeof window&&window.requestAnimationFrame.bind(window)||setTimeout,S=!1;function O(t,e,n){var r;r=function(){t[e]=n},N((function(){N(r)}))}function j(t,e){var n,r,o=e.elm,i=t.data.style,l=e.data.style;if((i||l)&&i!==l){l=l||{};var u="delayed"in(i=i||{});for(r in i)l[r]||("-"===r[0]&&"-"===r[1]?o.style.removeProperty(r):o.style[r]="");for(r in l)if(n=l[r],"delayed"===r&&l.delayed)for(var a in l.delayed)n=l.delayed[a],u&&n===i.delayed[a]||O(o.style,a,n);else"remove"!==r&&n!==i[r]&&("-"===r[0]&&"-"===r[1]?o.style.setProperty(r,n):o.style[r]=n)}}var A={pre:function(){S=!1},create:j,update:j,destroy:function(t){var e,n,r=t.elm,o=t.data.style;if(o&&(e=o.destroy))for(n in e)r.style[n]=e[n]},remove:function(t,e){var n=t.data.style;if(n&&n.remove){var r;S||(t.elm.offsetLeft,S=!0);var o=t.elm,i=0,l=n.remove,u=0,a=[];for(r in l)a.push(r),o.style[r]=l[r];for(var c=getComputedStyle(o)["transition-property"].split(", ");i<c.length;++i)-1!==a.indexOf(c[i])&&u++;o.addEventListener("transitionend",(function(t){t.target===o&&--u,0===u&&e()}))}else e()}},L=function(t,e,n){var r={create:[],update:[],remove:[],destroy:[],pre:[],post:[]},p=void 0!==e?e:o;for(var m of h)for(var g of t){var y=g[m];void 0!==y&&r[m].push(y)}function w(t){var e=t.id?"#"+t.id:"",n=t.getAttribute("class"),r=n?"."+n.split(" ").join("."):"";return i(p.tagName(t).toLowerCase()+e+r,{},[],void 0,t)}function x(t){return i(void 0,{},[],void 0,t)}function b(t,e){return function(){if(0==--e){var n=p.parentNode(t);p.removeChild(n,t)}}}function C(t,e){var o,i,s,v,h,m=t.data;if(void 0!==m){var g=null===(o=m.hook)||void 0===o?void 0:o.init;c(g)&&(g(t),m=t.data)}var y=t.children,w=t.sel;if("!"===w)a(t.text)&&(t.text=""),t.elm=p.createComment(t.text);else if(void 0!==w){var x=w.indexOf("#"),b=w.indexOf(".",x),E=x>0?x:w.length,_=b>0?b:w.length,T=-1!==x||-1!==b?w.slice(0,Math.min(E,_)):w,N=t.elm=c(m)&&c(h=m.ns)?p.createElementNS(h,T,m):p.createElement(T,m);for(E<_&&N.setAttribute("id",w.slice(E+1,_)),b>0&&N.setAttribute("class",w.slice(_+1).replace(/\./g," ")),h=0;h<r.create.length;++h)r.create[h](f,t);if(l(y))for(h=0;h<y.length;++h){var S=y[h];null!=S&&p.appendChild(N,C(S,e))}else u(t.text)&&p.appendChild(N,p.createTextNode(t.text));var O=t.data.hook;c(O)&&(null===(i=O.create)||void 0===i||i.call(O,f,t),O.insert&&e.push(t))}else if((null===(s=null==n?void 0:n.experimental)||void 0===s?void 0:s.fragments)&&t.children){for(t.elm=(null!==(v=p.createDocumentFragment)&&void 0!==v?v:d)(),h=0;h<r.create.length;++h)r.create[h](f,t);for(h=0;h<t.children.length;++h){var j=t.children[h];null!=j&&p.appendChild(t.elm,C(j,e))}}else t.elm=p.createTextNode(t.text);return t.elm}function E(t,e,n,r,o,i){for(;r<=o;++r){var l=n[r];null!=l&&p.insertBefore(t,C(l,i),e)}}function _(t){var e,n,o=t.data;if(void 0!==o){null===(n=null===(e=null==o?void 0:o.hook)||void 0===e?void 0:e.destroy)||void 0===n||n.call(e,t);for(var i=0;i<r.destroy.length;++i)r.destroy[i](t);if(void 0!==t.children)for(var l=0;l<t.children.length;++l){var u=t.children[l];null!=u&&"string"!=typeof u&&_(u)}}}function T(t,e,n,o){for(var i,l;n<=o;++n){var u=void 0,a=void 0,f=e[n];if(null!=f)if(c(f.sel)){_(f),u=r.remove.length+1,a=b(f.elm,u);for(var s=0;s<r.remove.length;++s)r.remove[s](f,a);var d=null===(l=null===(i=null==f?void 0:f.data)||void 0===i?void 0:i.hook)||void 0===l?void 0:l.remove;c(d)?d(f,a):a()}else f.children?(_(f),T(t,f.children,0,f.children.length-1)):p.removeChild(t,f.elm)}}function N(t,e,n){var o,i,l,u,f,d,h,m,g=null===(o=e.data)||void 0===o?void 0:o.hook;null===(i=null==g?void 0:g.prepatch)||void 0===i||i.call(g,t,e);var y=e.elm=t.elm;if(t!==e){if(void 0!==e.data||c(e.text)&&e.text!==t.text){null!==(l=e.data)&&void 0!==l||(e.data={}),null!==(u=t.data)&&void 0!==u||(t.data={});for(var w=0;w<r.update.length;++w)r.update[w](t,e);null===(h=null===(d=null===(f=e.data)||void 0===f?void 0:f.hook)||void 0===d?void 0:d.update)||void 0===h||h.call(d,t,e)}var x=t.children,b=e.children;a(e.text)?c(x)&&c(b)?x!==b&&function(t,e,n,r){for(var o,i,l,u=0,c=0,f=e.length-1,d=e[0],h=e[f],m=n.length-1,g=n[0],y=n[m];u<=f&&c<=m;)null==d?d=e[++u]:null==h?h=e[--f]:null==g?g=n[++c]:null==y?y=n[--m]:s(d,g)?(N(d,g,r),d=e[++u],g=n[++c]):s(h,y)?(N(h,y,r),h=e[--f],y=n[--m]):s(d,y)?(N(d,y,r),p.insertBefore(t,d.elm,p.nextSibling(h.elm)),d=e[++u],y=n[--m]):s(h,g)?(N(h,g,r),p.insertBefore(t,h.elm,d.elm),h=e[--f],g=n[++c]):(void 0===o&&(o=v(e,u,f)),a(i=o[g.key])||(l=e[i]).sel!==g.sel?p.insertBefore(t,C(g,r),d.elm):(N(l,g,r),e[i]=void 0,p.insertBefore(t,l.elm,d.elm)),g=n[++c]);c<=m&&E(t,null==n[m+1]?null:n[m+1].elm,n,c,m,r),u<=f&&T(t,e,u,f)}(y,x,b,n):c(b)?(c(t.text)&&p.setTextContent(y,""),E(y,null,b,0,b.length-1,n)):c(x)?T(y,x,0,x.length-1):c(t.text)&&p.setTextContent(y,""):t.text!==e.text&&(c(x)&&T(y,x,0,x.length-1),p.setTextContent(y,e.text)),null===(m=null==g?void 0:g.postpatch)||void 0===m||m.call(g,t,e)}}return function(t,e){var n,o,i,l=[];for(n=0;n<r.pre.length;++n)r.pre[n]();for(!function(t,e){return t.isElement(e)}(p,t)?function(t,e){return t.isDocumentFragment(e)}(p,t)&&(t=x(t)):t=w(t),s(t,e)?N(t,e,l):(o=t.elm,i=p.parentNode(o),C(e,l),null!==i&&(p.insertBefore(i,e.elm,p.nextSibling(o)),T(i,[t],0,0))),n=0;n<l.length;++n)l[n].data.hook.insert(l[n]);for(n=0;n<r.post.length;++n)r.post[n]();return e}}([T,A,E,w]),k=function(t){return e=t,function(t,n,r){return o=t(n,r),e=L(e,o);var o};var e},R=function(){function t(e,n){var r=Object.create(t.prototype),o=arguments.length;return function(){if(2!==o)return function(){throw new Error("_effectful received invalid number of arguments.")}.call(this)}.call(this),r.state=e,r.effects=n,r}return t.is=function(e){return e instanceof t},t}.call(void 0);R.prototype.run=function(t,e,n){return function(r){return function(){if(r.state!==t)return e.forEach((function(t){return t({state:r.state})})),function(){if(Array.isArray(r.effects)&&r.effects.length>0)return requestAnimationFrame((function(){return r.effects.forEach((function(t){return t(n,r.state)}))}))}.call(this)}.call(this),r}(this)},R.prototype.extract=function(){return this.state};var B=function(t){return new URLSearchParams(t).entries().reduce((function(t,e){var n=e[0],r=e[1];return t[n]=r,t}),Object.create(null))},F=function(){return{url:window.location.href,origin:window.location.origin,host:window.location.hostname,port:window.location.port,protocol:location.protocol,path:window.location.pathname,hash:window.location.hash,search:B(window.location.search)}},D=function(t,e,n){return e[n]===t},P=function(t){return D(":",t,0)},$=function(t){return t.split(new RegExp("\\/","g"))},U=function(t){return t.replace(new RegExp("\\/+","g"),"/").replace(new RegExp("^\\/|\\/$","g"),"")},q=function(t,e){return n=U(t),r=U(e),n===r?1/0:(o=n,new RegExp("^404$","g").test(o)?.5:function(t,e){return function(){return t.length!==e.length?0:e.reduce((function(e,n,r){return function(){return P(n)?1+e:D(n,t,r)?2+e:e}.call(this)}),0)}.call(this)}($(r),$(n)));var n,r,o},M=function(t,e){return n=$(U(t)),r=$(U(e)),n.reduce((function(t,e,n){return function(){return P(e)?(o=e.slice(1),t[o]=r[n],t):t;var o}.call(this)}),Object.create(null));var n,r},Z=function(){var t=Object.create(null);return t.prototype={__sibilispType__:t},t.moveTo=function e(n,r){var o=Object.create(t.prototype),i=arguments.length;return function(){if(2!==i)return function(){throw new Error("Tagged constructor "+Z+"."+e+"expects 2 arguments but got "+i)}.call(this)}.call(this),o.url=n,o.action=r,o.constructor=e,o.__sibilispCtor__="move-to",o.__sibilispTags__=["url","action"],o},t.resolve=function e(n,r){var o=Object.create(t.prototype),i=arguments.length;return function(){if(2!==i)return function(){throw new Error("Tagged constructor "+Z+"."+e+"expects 2 arguments but got "+i)}.call(this)}.call(this),o.url=n,o.action=r,o.constructor=e,o.__sibilispCtor__="resolve",o.__sibilispTags__=["url","action"],o},t.prototype.match=function(t){var e=this,n=e.__sibilispCtor__,r=t[n],o=e.__sibilispTags__;return function(){return"function"==typeof r?r.apply(e,o.map((function(t){return e[t]}))):"function"==typeof t.else?t.else.apply(e,o.map((function(t){return e[t]}))):function(){throw new Error(".match :: Cannot find "+n+" in patterns "+t)}.call(this)}.call(this)},t.is=function(e){return!(null==e)&&e.__sibilispType__===t},t}.call(void 0),z=function(t,e){return Z.resolve(t,e)},G=function(t,e){var n,r;e=Array.prototype.slice.call(arguments,1);return n=t.dispatch,r=t.notify,e.forEach((function(e){return r=e.el,o=e.view,i=k(r),t.subscribe((function(t){return r=i(o,t,n)}));var r,o,i})),function(t){return function(){return null!=t?n(t):r()}.call(this),null}},H=function(t,e,n){return n=void 0!==n?n:[],function(t,e,r,o,i,l){return i.getState=function(){return function(){if(!r)return function(){throw new Error("(silux/store.get-state) is disallowed during a dispatch")}.call(this)}.call(this),{state:t}},i.dispatch=function(n){return function(){if(!r)return function(){throw new Error("(silux/store.dispatch) is disallowed during a dispatch")}.call(this)}.call(this),u=i.dispatch,r=!1,e=t,t=l(t,n,u).run(e,o,u).extract(),r=!0,i;var u},i.subscribe=function(t){return function(){if(!r)return function(){throw new Error("(silux/store.subscribe) is disallowed during a dispatch")}.call(this)}.call(this),function(){if(!o.has(t))return o.add(t)}.call(this),i},i.notify=function(){return function(){if(!r)return function(){throw new Error("(silux/store.notify) is disallowed during a dispatch")}.call(this)}.call(this),o.forEach((function(e){return e({state:t})})),i},n.reduce((function(t,e){return e(t)}),i)}(t,null,!0,new Set([]),Object.create(null),(r=e,function(t,e,n){return function(t){return function(){if(!R.is(t))return t=R(t,[])}.call(this),t}(r(t,e,n))}));var r},I=function(t){t=Array.prototype.slice.call(arguments,0);return function(e,n,r){return t.reduce((function(t,e){return e(t,n,r)}),e)}},J=function(t,e){e=Array.prototype.slice.call(arguments,1);return R(t,e)},K=function(t,e,n){return m(t,null!=e&&e.constructor===Object?e:Object.create(null),n.map((function(t){return"number"!=typeof t||Number.isNaN(t)?t:String(t)})))},Q=function(t){return n=getBaseUi(),r=Object.entries(t),e=function(t){return r.reduce((function(e,r){var o=r[0],i=r[1];return function(r){return function(){return r>0?e.concat({r:r,s:o,p:M(n+o,t),v:i}):e}.call(this)}(q(n+o,t))}),[]).sort((function(t,e){return t.r>e.r?-1:e.r>t.r?1:0}))[0]},function(t,n){var r=t.state;return function(t){return function(){return null!=t?t.v({state:r,route:Object.assign({},F(),{params:t.p,slug:t.s})},n):function(t){return"silux/route-error: found no matching route definition for "+t}(window.location.pathname)}.call(this)}(e(window.location.pathname))};var e,n,r},V=function(){return function(t){return function(e,n,r,o){return o.getState=function(){return{state:r().state,route:F()}},o.dispatch=function(t){return function(){return actionRouter.is(t)?t.match({resolve:function(t,r){return function(){return null!=r?e(r):n()}.call(this)},moveTo:function(t,r){return function(t,e){e=void 0!==e?e:{},window.history.pushState(e,"",t)}(t),function(){return null!=r?e(r):n()}.call(this)}}):e(t)}.call(this),o},o.subscribe=t.subscribe,o.notify=n,function(){var t={passive:!0},e=function(){return o.dispatch(z(location.pathname))},n=function(){return window.removeEventListener("popstate",e,t),window.removeEventListener("beforeunload",n,t)};return window.addEventListener("popstate",e,t),window.addEventListener("beforeunload",n,t),o}.call(this)}(t.dispatch,t.notify,t.getState,Object.create(null))}},W=function(t,e){return Z.moveTo(t,e)},X=z;t.goRoute=W,t.h=K,t.resolveRoute=X,t.siluxConnect=G,t.siluxFoldUpdates=I,t.siluxRouter=Q,t.siluxRouterPlugin=V,t.siluxStore=H,t.withEffects=J,Object.defineProperty(t,"__esModule",{value:!0})}));
