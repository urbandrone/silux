// silux 0.8.0 | MIT | https://github.com/urbandrone/silux
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).silux={})}(this,(function(e){"use strict";function t(e){if(n(e)){for(;e&&n(e);){e=r(e).parent}return null!=e?e:null}return e.parentNode}function n(e){return 11===e.nodeType}function r(e,t){var n,r,o,i=e;return null!==(n=i.parent)&&void 0!==n||(i.parent=null!=t?t:null),null!==(r=i.firstChildNode)&&void 0!==r||(i.firstChildNode=e.firstChild),null!==(o=i.lastChildNode)&&void 0!==o||(i.lastChildNode=e.lastChild),i}var o={createElement:function(e,t){return document.createElement(e,t)},createElementNS:function(e,t,n){return document.createElementNS(e,t,n)},createTextNode:function(e){return document.createTextNode(e)},createDocumentFragment:function(){return r(document.createDocumentFragment())},createComment:function(e){return document.createComment(e)},insertBefore:function(e,t,o){if(n(e)){for(var i=e;i&&n(i);){i=r(i).parent}e=null!=i?i:e}n(t)&&(t=r(t,e)),o&&n(o)&&(o=r(o).firstChildNode),e.insertBefore(t,o)},removeChild:function(e,t){e.removeChild(t)},appendChild:function(e,t){n(t)&&(t=r(t,e)),e.appendChild(t)},parentNode:t,nextSibling:function(e){var o;if(n(e)){var i=r(e),l=t(i);if(l&&i.lastChildNode){var u=Array.from(l.childNodes),a=u.indexOf(i.lastChildNode);return null!==(o=u[a+1])&&void 0!==o?o:null}return null}return e.nextSibling},tagName:function(e){return e.tagName},setTextContent:function(e,t){e.textContent=t},getTextContent:function(e){return e.textContent},isElement:function(e){return 1===e.nodeType},isText:function(e){return 3===e.nodeType},isComment:function(e){return 8===e.nodeType},isDocumentFragment:n};function i(e,t,n,r,o){return{sel:e,data:t,children:n,text:r,elm:o,key:void 0===t?void 0:t.key}}var l=Array.isArray;function u(e){return"string"==typeof e||"number"==typeof e||e instanceof String||e instanceof Number}function a(e){return void 0===e}function c(e){return void 0!==e}var f=i("",{},[],void 0,void 0);function d(e,t){var n,r,o=e.key===t.key,i=(null===(n=e.data)||void 0===n?void 0:n.is)===(null===(r=t.data)||void 0===r?void 0:r.is),l=e.sel===t.sel,u=!(!e.sel&&e.sel===t.sel)||typeof e.text==typeof t.text;return l&&o&&i&&u}function s(){throw new Error("The document fragment is not supported on this platform.")}function v(e,t,n){for(var r,o={},i=t;i<=n;++i){var l=null===(r=e[i])||void 0===r?void 0:r.key;void 0!==l&&(o[l]=i)}return o}var h=["create","update","remove","destroy","pre","post"];function p(e,t,n){if(e.ns="http://www.w3.org/2000/svg","foreignObject"!==n&&void 0!==t)for(var r=0;r<t.length;++r){var o=t[r];if("string"!=typeof o){var i=o.data;void 0!==i&&p(i,o.children,o.sel)}}}function m(e,t,n){var r,o,a,c={};if(void 0!==n?(null!==t&&(c=t),l(n)?r=n:u(n)?o=n.toString():n&&n.sel&&(r=[n])):null!=t&&(l(t)?r=t:u(t)?o=t.toString():t&&t.sel?r=[t]:c=t),void 0!==r)for(a=0;a<r.length;++a)u(r[a])&&(r[a]=i(void 0,void 0,void 0,r[a],void 0));return"s"!==e[0]||"v"!==e[1]||"g"!==e[2]||3!==e.length&&"."!==e[3]&&"#"!==e[3]||p(c,r,e),i(e,c,r,o,void 0)}var g=/[A-Z]/g;function y(e,t){var n,r=t.elm,o=e.data.dataset,i=t.data.dataset;if((o||i)&&o!==i){o=o||{},i=i||{};var l=r.dataset;for(n in o)i[n]||(l?n in l&&delete l[n]:r.removeAttribute("data-"+n.replace(g,"-$&").toLowerCase()));for(n in i)o[n]!==i[n]&&(l?l[n]=i[n]:r.setAttribute("data-"+n.replace(g,"-$&").toLowerCase(),i[n]))}}var w={create:y,update:y};function x(e,t,n){if("function"==typeof e)e.call(t,n,t);else if("object"==typeof e)for(var r=0;r<e.length;r++)x(e[r],t,n)}function b(e,t){var n=e.type,r=t.data.on;r&&r[n]&&x(r[n],t,e)}function C(e,t){var n,r=e.data.on,o=e.listener,i=e.elm,l=t&&t.data.on,u=t&&t.elm;if(r!==l){if(r&&o)if(l)for(n in r)l[n]||i.removeEventListener(n,o,!1);else for(n in r)i.removeEventListener(n,o,!1);if(l){var a=t.listener=e.listener||function e(t){b(t,e.vnode)};if(a.vnode=t,r)for(n in l)r[n]||u.addEventListener(n,a,!1);else for(n in l)u.addEventListener(n,a,!1)}}}var E={create:C,update:C,destroy:C};function N(e,t){var n,r,o=t.elm,i=e.data.props,l=t.data.props;if((i||l)&&i!==l)for(n in i=i||{},l=l||{})r=l[n],i[n]===r||"value"===n&&o[n]===r||(o[n]=r)}var S={create:N,update:N},T="undefined"!=typeof window&&window.requestAnimationFrame.bind(window)||setTimeout,A=!1;function O(e,t,n){var r;r=function(){e[t]=n},T((function(){T(r)}))}function j(e,t){var n,r,o=t.elm,i=e.data.style,l=t.data.style;if((i||l)&&i!==l){l=l||{};var u="delayed"in(i=i||{});for(r in i)l[r]||("-"===r[0]&&"-"===r[1]?o.style.removeProperty(r):o.style[r]="");for(r in l)if(n=l[r],"delayed"===r&&l.delayed)for(var a in l.delayed)n=l.delayed[a],u&&n===i.delayed[a]||O(o.style,a,n);else"remove"!==r&&n!==i[r]&&("-"===r[0]&&"-"===r[1]?o.style.setProperty(r,n):o.style[r]=n)}}var L={pre:function(){A=!1},create:j,update:j,destroy:function(e){var t,n,r=e.elm,o=e.data.style;if(o&&(t=o.destroy))for(n in t)r.style[n]=t[n]},remove:function(e,t){var n=e.data.style;if(n&&n.remove){var r;A||(e.elm.offsetLeft,A=!0);var o=e.elm,i=0,l=n.remove,u=0,a=[];for(r in l)a.push(r),o.style[r]=l[r];for(var c=getComputedStyle(o)["transition-property"].split(", ");i<c.length;++i)-1!==a.indexOf(c[i])&&u++;o.addEventListener("transitionend",(function(e){e.target===o&&--u,0===u&&t()}))}else t()}},k=function(e,t,n){var r={create:[],update:[],remove:[],destroy:[],pre:[],post:[]},p=void 0!==t?t:o;for(var m of h)for(var g of e){var y=g[m];void 0!==y&&r[m].push(y)}function w(e){var t=e.id?"#"+e.id:"",n=e.getAttribute("class"),r=n?"."+n.split(" ").join("."):"";return i(p.tagName(e).toLowerCase()+t+r,{},[],void 0,e)}function x(e){return i(void 0,{},[],void 0,e)}function b(e,t){return function(){if(0==--t){var n=p.parentNode(e);p.removeChild(n,e)}}}function C(e,t){var o,i,d,v,h,m=e.data;if(void 0!==m){var g=null===(o=m.hook)||void 0===o?void 0:o.init;c(g)&&(g(e),m=e.data)}var y=e.children,w=e.sel;if("!"===w)a(e.text)&&(e.text=""),e.elm=p.createComment(e.text);else if(void 0!==w){var x=w.indexOf("#"),b=w.indexOf(".",x),E=x>0?x:w.length,N=b>0?b:w.length,S=-1!==x||-1!==b?w.slice(0,Math.min(E,N)):w,T=e.elm=c(m)&&c(h=m.ns)?p.createElementNS(h,S,m):p.createElement(S,m);for(E<N&&T.setAttribute("id",w.slice(E+1,N)),b>0&&T.setAttribute("class",w.slice(N+1).replace(/\./g," ")),h=0;h<r.create.length;++h)r.create[h](f,e);if(l(y))for(h=0;h<y.length;++h){var A=y[h];null!=A&&p.appendChild(T,C(A,t))}else u(e.text)&&p.appendChild(T,p.createTextNode(e.text));var O=e.data.hook;c(O)&&(null===(i=O.create)||void 0===i||i.call(O,f,e),O.insert&&t.push(e))}else if((null===(d=null==n?void 0:n.experimental)||void 0===d?void 0:d.fragments)&&e.children){for(e.elm=(null!==(v=p.createDocumentFragment)&&void 0!==v?v:s)(),h=0;h<r.create.length;++h)r.create[h](f,e);for(h=0;h<e.children.length;++h){var j=e.children[h];null!=j&&p.appendChild(e.elm,C(j,t))}}else e.elm=p.createTextNode(e.text);return e.elm}function E(e,t,n,r,o,i){for(;r<=o;++r){var l=n[r];null!=l&&p.insertBefore(e,C(l,i),t)}}function N(e){var t,n,o=e.data;if(void 0!==o){null===(n=null===(t=null==o?void 0:o.hook)||void 0===t?void 0:t.destroy)||void 0===n||n.call(t,e);for(var i=0;i<r.destroy.length;++i)r.destroy[i](e);if(void 0!==e.children)for(var l=0;l<e.children.length;++l){var u=e.children[l];null!=u&&"string"!=typeof u&&N(u)}}}function S(e,t,n,o){for(var i,l;n<=o;++n){var u=void 0,a=void 0,f=t[n];if(null!=f)if(c(f.sel)){N(f),u=r.remove.length+1,a=b(f.elm,u);for(var d=0;d<r.remove.length;++d)r.remove[d](f,a);var s=null===(l=null===(i=null==f?void 0:f.data)||void 0===i?void 0:i.hook)||void 0===l?void 0:l.remove;c(s)?s(f,a):a()}else f.children?(N(f),S(e,f.children,0,f.children.length-1)):p.removeChild(e,f.elm)}}function T(e,t,n){var o,i,l,u,f,s,h,m,g=null===(o=t.data)||void 0===o?void 0:o.hook;null===(i=null==g?void 0:g.prepatch)||void 0===i||i.call(g,e,t);var y=t.elm=e.elm;if(e!==t){if(void 0!==t.data||c(t.text)&&t.text!==e.text){null!==(l=t.data)&&void 0!==l||(t.data={}),null!==(u=e.data)&&void 0!==u||(e.data={});for(var w=0;w<r.update.length;++w)r.update[w](e,t);null===(h=null===(s=null===(f=t.data)||void 0===f?void 0:f.hook)||void 0===s?void 0:s.update)||void 0===h||h.call(s,e,t)}var x=e.children,b=t.children;a(t.text)?c(x)&&c(b)?x!==b&&function(e,t,n,r){for(var o,i,l,u=0,c=0,f=t.length-1,s=t[0],h=t[f],m=n.length-1,g=n[0],y=n[m];u<=f&&c<=m;)null==s?s=t[++u]:null==h?h=t[--f]:null==g?g=n[++c]:null==y?y=n[--m]:d(s,g)?(T(s,g,r),s=t[++u],g=n[++c]):d(h,y)?(T(h,y,r),h=t[--f],y=n[--m]):d(s,y)?(T(s,y,r),p.insertBefore(e,s.elm,p.nextSibling(h.elm)),s=t[++u],y=n[--m]):d(h,g)?(T(h,g,r),p.insertBefore(e,h.elm,s.elm),h=t[--f],g=n[++c]):(void 0===o&&(o=v(t,u,f)),a(i=o[g.key])||(l=t[i]).sel!==g.sel?p.insertBefore(e,C(g,r),s.elm):(T(l,g,r),t[i]=void 0,p.insertBefore(e,l.elm,s.elm)),g=n[++c]);c<=m&&E(e,null==n[m+1]?null:n[m+1].elm,n,c,m,r),u<=f&&S(e,t,u,f)}(y,x,b,n):c(b)?(c(e.text)&&p.setTextContent(y,""),E(y,null,b,0,b.length-1,n)):c(x)?S(y,x,0,x.length-1):c(e.text)&&p.setTextContent(y,""):e.text!==t.text&&(c(x)&&S(y,x,0,x.length-1),p.setTextContent(y,t.text)),null===(m=null==g?void 0:g.postpatch)||void 0===m||m.call(g,e,t)}}return function(e,t){var n,o,i,l=[];for(n=0;n<r.pre.length;++n)r.pre[n]();for(!function(e,t){return e.isElement(t)}(p,e)?function(e,t){return e.isDocumentFragment(t)}(p,e)&&(e=x(e)):e=w(e),d(e,t)?T(e,t,l):(o=e.elm,i=p.parentNode(o),C(t,l),null!==i&&(p.insertBefore(i,t.elm,p.nextSibling(o)),S(i,[e],0,0))),n=0;n<l.length;++n)l[n].data.hook.insert(l[n]);for(n=0;n<r.post.length;++n)r.post[n]();return t}}([S,L,E,w]),R=function(e){return t=e,function(e,n,r){return o=e(n,r),t=k(t,o);var o};var t},B=function(){function e(t,n){var r=Object.create(e.prototype),o=arguments.length;return function(){if(2!==o)return function(){throw new Error("_effectful received invalid number of arguments.")}.call(this)}.call(this),r.state=t,r.effects=n,r}return e.is=function(t){return t instanceof e},e}.call(void 0);B.prototype.run=function(e,t,n){return function(r){return function(){if(r.state!==e)return t.forEach((function(e){return e({state:r.state})})),function(){if(Array.isArray(r.effects)&&r.effects.length>0)return requestAnimationFrame((function(){return r.effects.forEach((function(e){return e(n,r.state)}))}))}.call(this)}.call(this),r}(this)},B.prototype.extract=function(){return this.state};var F=function(e){return Array.from(new URLSearchParams(e).entries()).reduce((function(e,t){var n=t[0],r=t[1];return e[n]=r,e}),Object.create(null))},D=function(){return{url:window.location.href,origin:window.location.origin,host:window.location.hostname,port:window.location.port,protocol:location.protocol,path:window.location.pathname,hash:window.location.hash,search:F(window.location.search)}},P=function(e,t,n){return t[n]===e},$=function(e){return P(":",e,0)},U=function(e){return e.split(new RegExp("\\/","g"))},_=function(e){return e.replace(new RegExp("\\/+","g"),"/").replace(new RegExp("^\\/|\\/$","g"),"")},q=function(e,t){return n=_(e),r=_(t),n===r?1/0:(o=n,new RegExp("^404$","g").test(o)?.5:function(e,t){return function(){return e.length!==t.length?0:t.reduce((function(t,n,r){return function(){return $(n)?1+t:P(n,e,r)?2+t:t}.call(this)}),0)}.call(this)}(U(r),U(n)));var n,r,o},M=function(e,t){return n=U(_(e)),r=U(_(t)),n.reduce((function(e,t,n){return function(){return $(t)?(o=t.slice(1),e[o]=r[n],e):e;var o}.call(this)}),Object.create(null));var n,r},I=function(){function e(t,n){var r=Object.create(e.prototype),o=arguments.length;return function(){if(2!==o)return function(){throw new Error("routerNavigate received invalid number of arguments.")}.call(this)}.call(this),r.url=t,r.action=n,r}return e.is=function(t){return t instanceof e},e}.call(void 0),Z=function(e,t){var n,r;t=Array.prototype.slice.call(arguments,1);return n=e.dispatch,r=e.notify,t.forEach((function(t){return r=t.el,o=t.view,i=R(r),e.subscribe((function(e){return r=i(o,e,n)}));var r,o,i})),function(e){return function(){return null!=e?n(e):r()}.call(this),null}},z=function(e,t,n){return n=void 0!==n?n:[],function(e,t,r,o,i,l){return i.getState=function(){return function(){if(!r)return function(){throw new Error("(silux/store.get-state) is disallowed during a dispatch")}.call(this)}.call(this),{state:e}},i.dispatch=function(n){return function(){if(!r)return function(){throw new Error("(silux/store.dispatch) is disallowed during a dispatch")}.call(this)}.call(this),u=i.dispatch,r=!1,t=e,e=l(e,n,u).run(t,o,u).extract(),r=!0,i;var u},i.subscribe=function(e){return function(){if(!r)return function(){throw new Error("(silux/store.subscribe) is disallowed during a dispatch")}.call(this)}.call(this),function(){if(!o.has(e))return o.add(e)}.call(this),i},i.notify=function(){return function(){if(!r)return function(){throw new Error("(silux/store.notify) is disallowed during a dispatch")}.call(this)}.call(this),o.forEach((function(t){return t({state:e})})),i},n.reduce((function(e,t){return t(e)}),i)}(e,null,!0,new Set([]),Object.create(null),(r=t,function(e,t,n){return function(e){return function(){if(!B.is(e))return e=B(e,[])}.call(this),e}(r(e,t,n))}));var r},G=function(e){e=Array.prototype.slice.call(arguments,0);return function(t,n,r){return e.reduce((function(e,t){return t(e,n,r)}),t)}},H=function(e,t){t=Array.prototype.slice.call(arguments,1);return B(e,t)},J=function(e,t,n){return m(e,null!=t&&t.constructor===Object?t:Object.create(null),n.map((function(e){return"number"!=typeof e||Number.isNaN(e)?e:String(e)})))},K=function(e){return o=window.location.host,i=window.location.protocol,n=document.body.baseURI.replace(i+"//"+o,""),r=Object.entries(e),t=function(e){return r.reduce((function(t,r){var o=r[0],i=r[1];return function(r){return function(){return r>0?t.concat({r:r,s:o,p:M(n+o,e),v:i}):t}.call(this)}(q(n+o,e))}),[]).sort((function(e,t){return e.r>t.r?-1:t.r>e.r?1:0}))[0]},function(e,n){var r=e.state;return function(e){return function(){return null!=e?e.v({state:r,route:Object.assign({},D(),{params:e.p,slug:e.s})},n):function(e){return"silux/route-error: found no matching route definition for "+e}(window.location.pathname)}.call(this)}(t(window.location.pathname))};var t,n,r,o,i},Q=function(){return function(e){return function(t,n,r,o){return o.getState=function(){return{state:r().state,route:D()}},o.dispatch=function(e){return function(){return I.is(e)?(r=e.url,o=void 0!==o?o:null,window.history.pushState(o,"",r),function(){return null!=e.action?t(e.action):n()}.call(this)):t(e);var r,o}.call(this),o},o.subscribe=e.subscribe,o.notify=n,function(){var e={passive:!0},t=function(){return window.removeEventListener("popstate",n,e),window.removeEventListener("beforeunload",t,e)};return window.addEventListener("popstate",n,e),window.addEventListener("beforeunload",t,e),o}.call(this)}(e.dispatch,e.notify,e.getState,Object.create(null))}},V=function(e,t){return I(e,t)};e.goRoute=V,e.h=J,e.siluxConnect=Z,e.siluxFoldUpdates=G,e.siluxRouter=K,e.siluxRouterPlugin=Q,e.siluxStore=z,e.withEffects=H,Object.defineProperty(e,"__esModule",{value:!0})}));
